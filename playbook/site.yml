---
- hosts: agents
  user: root
  vars_files:
    - vars/app.yml
  vars: 
    github_repo: keyvanfatehi/saasbox-agent.git
    deploy_to: /opt/saasbox/agent
    verifies:
      - url: "https://{{ name }}.{{fqdn}}/api/v1/version"
        status: 200
    exposed_ports:
      - 22
      - 80
      - 443
  roles:
    - common
    - docker
    - agent

- hosts: databases
  user: root
  vars_files:
    - vars/app.yml
  vars:
    exposed_ports:
      - 22
      - 27017
  roles:
    - common
    - mongodb

- hosts: workers
  user: root
  vars_files:
    - vars/app.yml
  vars: 
    github_repo: keyvanfatehi/saasbox-app.git
    deploy_to: /opt/saasbox/app
    dns_nameservers:
      - 192.241.223.137 # box.pillbox.io
      - 8.8.4.4
      - 8.8.8.8
  roles:
    - dns
    - common
    - worker

- hosts: webservers
  user: root
  vars_files:
    - vars/app.yml
  vars: 
    github_repo: keyvanfatehi/saasbox-app.git
    deploy_to: /opt/saasbox/app
    verifies:
      - url: "https://{{ inventory_hostname }}"
        status: 200
      - url: "https://{{ fqdn }}"
        status: 200
    exposed_ports:
      - 22
      - 80
      - 443
  roles:
    - common
    - web
